const translations = {
  en: {
    nav_home: 'Home',
    nav_products: 'Products',
    nav_contact: 'Contact',
    theme_toggle: 'Toggle Theme',
    language_label: 'Language',
    home_title: 'KENTACK Luxury Golf Experience',
    home_desc: 'Discover high-end golf gear for champions.',
      hero_cta: 'Shop Now',
      explore_collection: 'Explore the Collection',
      crafted_limited_timeless: 'Crafted. Limited. Timeless.',
      find_out_more: 'Find out more',
      story_title: 'Message from Ken Karahawa',
    story_message: `The name Golf Honma has long symbolized top-class Japanese craftsmanship, admired by golfers worldwide. Our KENTACK brand carries forward this proud tradition and superior techniques. Founded in 2007 by Yukihiro Honma, co-founder of Honma Golf, KENTACK was created to preserve the spirit and identity of the original Honma legacy after the brand became foreign-owned.\n\nYukihiro Honma, a master craftsman, once produced the finest clubs under the name HIRO HONMA, blending performance and beauty with over 50 years of expertise. With KENTACK, he revived that genuine tradition. Though he has since stepped back, his techniques and philosophy remain at the heart of our work.\n\nToday, KENTACK continues to craft elegant, precise, and high-performing clubs through meticulous Japanese artistry. We are committed to honoring our heritage while advancing technology, delivering top-quality clubs that add value for discerning golfers worldwide.`,
    products_title: 'Our Products',
    category_clubs: 'Clubs',
    category_bags: 'Bags',
    category_balls: 'Balls',
    category_tees: 'Tees',
    category_accessories: 'Accessories',
      club_drivers: 'Drivers',
      club_woods: 'Woods',
    club_irons: 'Irons',
    club_hybrids: 'Hybrids',
    club_wedges: 'Wedges',
    club_putters: 'Putters',
    view_4x4: '4 x 4',
    view_5x5: '5 x 5',
    no_products: 'No products available.',
    contact_title: 'Contact Us',
    contact_phone: 'Phone: 0899033692',
    contact_location_title: 'Location',
    contact_location: 'Phố Tân Mỹ, Phương Quan, Nam Từ Liêm, Hà Nội, Vietnam',
    product_kh888_name: 'KH888 Driver',
    product_kh888_desc: 'High-performance driver.',
    product_kh888_price: 'Starting from $1,110',
      product_kh888_details: `The KH888 builds on the iconic golfing technology developed by legendary Japanese golf master Honma Hiro. During his time as Vice President of Honma Golf, Hiro specialized in developing clubs that were able to increase flight distance with ease for both professionals and novices alike. This beautiful red lacquer finished driver has all of the Honma Hiro trademarks of elite performance and sophisticated design. The head and shaft have been painted by a Japanese traditional technique known as Maki-e. This artistic method involves craftsmen carefully applying multiple layers of lacquer. The product is then finished by hand with a sprinkle of 24k gold leaf. The result is a stunningly opulent club with incredibly high performance.`,
      product_kh888_specs: `
<table class="spec-table">
  <tr><th colspan="2">KH888 DRIVER</th></tr>
  <tr><td>HEAD material / Manufacturing process</td><td>6-4 TITANIUM / Forged</td></tr>
  <tr><td>FACE material</td><td>2041CUP Face</td></tr>
  <tr><td>LOFT(deg)</td><td>10.5 / 9.5</td></tr>
  <tr><td>FA(Face angle)</td><td>1.5</td></tr>
  <tr><td>Lie angle(deg)</td><td>60</td></tr>
  <tr><td>HEAD volume(cc)</td><td>500</td></tr>
  <tr><td>Distance to center of gravity(mm)</td><td>42</td></tr>
  <tr><td>Depth to center of gravity(mm)</td><td>39</td></tr>
  <tr><td>Degree of gravity</td><td>24</td></tr>
  <tr><td>High of gravity(mm)</td><td>35.2</td></tr>
  <tr><td>Head of gravity(g)</td><td>198g</td></tr>
  <tr><td>CT(Characteristic time)</td><td>290</td></tr>
</table>
`,
    product_kh555_name: 'KH555 Driver',
    product_kh555_desc: 'Forged precision driver.',
    product_kh555_price: 'Starting from $1,400',
    product_kh555_details: 'Crafted for control and distance, the KH555 blends advanced materials with classic shaping to inspire confidence from the tee.'
  },
  vi: {
    nav_home: 'Trang chủ',
    nav_products: 'Sản phẩm',
    nav_contact: 'Liên hệ',
    theme_toggle: 'Đổi chủ đề',
    language_label: 'Ngôn ngữ',
    home_title: 'KENTACK - Trải nghiệm Golf Sang Trọng',
    home_desc: 'Khám phá thiết bị golf cao cấp dành cho nhà vô địch.',
      hero_cta: 'Mua Ngay',
      explore_collection: 'Khám phá Bộ Sưu Tập',
      crafted_limited_timeless: 'Tinh xảo. Giới hạn. Vượt thời gian.',
      find_out_more: 'Tìm hiểu thêm',
      story_title: 'Thông điệp từ Ken Karahawa',
    story_message: `Tên Golf Honma từ lâu đã tượng trưng cho tay nghề Nhật Bản đẳng cấp, được các golfer trên toàn thế giới ngưỡng mộ. Thương hiệu KENTACK của chúng tôi tiếp nối truyền thống đáng tự hào và kỹ thuật ưu việt đó. Được thành lập năm 2007 bởi ông Yukihiro Honma, đồng sáng lập Honma Golf, KENTACK ra đời để gìn giữ tinh thần và bản sắc di sản Honma nguyên bản sau khi thương hiệu trở thành sở hữu nước ngoài.\n\nYukihiro Honma, một bậc thầy chế tác, từng tạo ra những cây gậy hoàn hảo nhất dưới tên HIRO HONMA, kết hợp hiệu suất và vẻ đẹp với hơn 50 năm kinh nghiệm. Với KENTACK, ông đã hồi sinh truyền thống chân chính đó. Dù nay ông đã lui về, kỹ thuật và triết lý của ông vẫn là cốt lõi trong công việc của chúng tôi.\n\nNgày nay, KENTACK tiếp tục chế tác những cây gậy thanh lịch, chính xác và hiệu suất cao bằng nghệ thuật Nhật Bản tỉ mỉ. Chúng tôi cam kết tôn vinh di sản đồng thời phát triển công nghệ, mang đến những cây gậy chất lượng hàng đầu tạo giá trị cho các golfer sành điệu trên toàn thế giới.`,
    products_title: 'Sản phẩm của chúng tôi',
    category_clubs: 'Gậy',
    category_bags: 'Túi',
    category_balls: 'Bóng',
    category_tees: 'Tee',
    category_accessories: 'Phụ kiện',
    club_drivers: 'Gậy driver',
    club_woods: 'Gậy gỗ',
    club_irons: 'Gậy sắt',
    club_hybrids: 'Gậy hybrid',
    club_wedges: 'Gậy kĩ thuật',
    club_putters: 'Gậy putter',
    view_4x4: '4 x 4',
    view_5x5: '5 x 5',
    no_products: 'Không có sản phẩm.',
    contact_title: 'Liên hệ với chúng tôi',
    contact_phone: 'Điện thoại: 0899033692',
    contact_location_title: 'Địa chỉ',
    contact_location: 'Phố Tân Mỹ, Phương Quan, Nam Từ Liêm, Hà Nội, Vietnam',
    product_kh888_name: 'Driver KH888',
    product_kh888_desc: 'Gậy driver hiệu suất cao.',
    product_kh888_price: 'Giá khởi điểm từ <em>29,000,000 VND</em>',
        product_kh888_details: `KH888 kế thừa công nghệ golf mang tính biểu tượng do huyền thoại Nhật Bản Honma Hiro phát triển. Trong thời gian giữ chức Phó Chủ tịch Honma Golf, Hiro chuyên nghiên cứu những cây gậy có thể dễ dàng tăng khoảng cách bay cho cả golfer chuyên nghiệp lẫn người mới chơi. Chiếc driver hoàn thiện bằng sơn mài đỏ tuyệt đẹp này mang đầy đủ dấu ấn Honma Hiro về hiệu suất đỉnh cao và thiết kế tinh tế. Phần đầu và thân gậy được sơn bằng kỹ thuật truyền thống của Nhật Bản gọi là Maki-e. Phương pháp nghệ thuật này đòi hỏi nghệ nhân tỉ mỉ phủ nhiều lớp sơn mài. Sản phẩm sau đó được hoàn thiện thủ công với một lớp rắc lá vàng 24k. Kết quả là một cây gậy xa hoa lộng lẫy với hiệu suất cực kỳ cao.`,
        product_kh888_specs: `
<table class="spec-table">
  <tr><th colspan="2">KH888 DRIVER</th></tr>
  <tr><td>HEAD material / Manufacturing process</td><td>6-4 TITANIUM / Forged</td></tr>
  <tr><td>FACE material</td><td>2041CUP Face</td></tr>
  <tr><td>LOFT(deg)</td><td>10.5 / 9.5</td></tr>
  <tr><td>FA(Face angle)</td><td>1.5</td></tr>
  <tr><td>Lie angle(deg)</td><td>60</td></tr>
  <tr><td>HEAD volume(cc)</td><td>500</td></tr>
  <tr><td>Distance to center of gravity(mm)</td><td>42</td></tr>
  <tr><td>Depth to center of gravity(mm)</td><td>39</td></tr>
  <tr><td>Degree of gravity</td><td>24</td></tr>
  <tr><td>High of gravity(mm)</td><td>35.2</td></tr>
  <tr><td>Head of gravity(g)</td><td>198g</td></tr>
  <tr><td>CT(Characteristic time)</td><td>290</td></tr>
</table>
`,
    product_kh555_name: 'Driver KH555',
    product_kh555_desc: 'Gậy driver rèn chính xác.',
    product_kh555_price: 'Giá khởi điểm từ <em>36,000,000 VND</em>',
    product_kh555_details: 'Được chế tác để kiểm soát và khoảng cách, KH555 kết hợp vật liệu tiên tiến với thiết kế cổ điển giúp bạn tự tin khi phát bóng.'
  },
  ja: {
    nav_home: 'ホーム',
    nav_products: '製品',
    nav_contact: 'お問い合わせ',
    theme_toggle: 'テーマ切替',
    language_label: '言語',
    home_title: 'KENTACK ラグジュアリーなゴルフ体験',
    home_desc: 'チャンピオンのための高級ゴルフ用品を見つけましょう。',
      hero_cta: '今すぐ購入',
      explore_collection: 'コレクションを探る',
      crafted_limited_timeless: '匠の技。限定。時を超えて。',
      find_out_more: '詳しく見る',
      story_title: '唐川ケンからのメッセージ',
    story_message: `「ゴルフ本間」という名前は、長年にわたり日本最高峰の職人技の象徴として、世界中のゴルファーに愛されてきました。私たちのKENTACKブランドは、この誇り高い伝統と優れた技術を受け継いでいます。KENTACKは本間ゴルフの共同創業者、本間幸宏によって2007年に設立され、ブランドが外国資本となった後も本来の本間の精神とアイデンティティを守るために生まれました。\n\n名匠である本間幸宏は、かつてHIRO HONMAの名で最高級のクラブを作り上げ、50年以上の経験で性能と美を融合させました。KENTACKによって彼はその真の伝統を復活させました。現在は第一線を退いていますが、彼の技術と理念は今も私たちの中心にあります。\n\n今日のKENTACKは、緻密な日本の職人技でエレガントで精密、そして高性能なクラブを作り続けています。私たちは遺産を尊重しつつ技術を進化させ、世界中の目の肥えたゴルファーに価値ある最高品質のクラブを提供し続けます。`,
    products_title: '製品一覧',
    category_clubs: 'クラブ',
    category_bags: 'バッグ',
    category_balls: 'ボール',
    category_tees: 'ティー',
    category_accessories: 'アクセサリー',
    club_drivers: 'ドライバー',
    club_woods: 'ウッド',
    club_irons: 'アイアン',
    club_hybrids: 'ハイブリッド',
    club_wedges: 'ウェッジ',
    club_putters: 'パター',
    view_4x4: '4 x 4',
    view_5x5: '5 x 5',
    no_products: '商品がありません。',
    contact_title: 'お問い合わせ',
    contact_phone: '電話: 0899033692',
    contact_location_title: '住所',
    contact_location: 'Phố Tân Mỹ, Phương Quan, Nam Từ Liêm, Hà Nội, Vietnam',
    product_kh888_name: 'KH888ドライバー',
    product_kh888_desc: '高性能ドライバー。',
    product_kh888_price: '1,110ドルから',
        product_kh888_details: `KH888は、日本の伝説的なゴルフマスター本間弘が開発した象徴的なゴルフ技術を基に作られています。本間ゴルフの副社長を務めていた時期、弘氏はプロから初心者まで誰もが簡単に飛距離を伸ばせるクラブの開発に専念しました。この美しい赤い漆仕上げのドライバーには、本間弘ならではの卓越した性能と洗練されたデザインがすべて備わっています。ヘッドとシャフトには「蒔絵」と呼ばれる日本の伝統技法が施されています。この芸術的な手法では、職人が何層もの漆を丁寧に重ねていきます。そして製品は24Kの金箔を散らして手作業で仕上げられます。その結果、驚くほど高い性能を持つ豪華絢爛なクラブが完成します。`,
        product_kh888_specs: `
<table class="spec-table">
  <tr><th colspan="2">KH888 DRIVER</th></tr>
  <tr><td>HEAD material / Manufacturing process</td><td>6-4 TITANIUM / Forged</td></tr>
  <tr><td>FACE material</td><td>2041CUP Face</td></tr>
  <tr><td>LOFT(deg)</td><td>10.5 / 9.5</td></tr>
  <tr><td>FA(Face angle)</td><td>1.5</td></tr>
  <tr><td>Lie angle(deg)</td><td>60</td></tr>
  <tr><td>HEAD volume(cc)</td><td>500</td></tr>
  <tr><td>Distance to center of gravity(mm)</td><td>42</td></tr>
  <tr><td>Depth to center of gravity(mm)</td><td>39</td></tr>
  <tr><td>Degree of gravity</td><td>24</td></tr>
  <tr><td>High of gravity(mm)</td><td>35.2</td></tr>
  <tr><td>Head of gravity(g)</td><td>198g</td></tr>
  <tr><td>CT(Characteristic time)</td><td>290</td></tr>
</table>
`,
    product_kh555_name: 'KH555ドライバー',
    product_kh555_desc: '精密鍛造ドライバー。',
    product_kh555_price: '198,000円から',
    product_kh555_details: 'KH555は、先進素材とクラシックな形状を融合させ、ティーショットで自信を引き出すコントロール性と飛距離を実現します。'
  }
};

const htmlI18nKeys = ['product_kh888_price', 'product_kh555_price', 'product_kh888_specs'];

let carouselInterval;
let currentDevice;

function setLanguage(lang) {
  localStorage.setItem('lang', lang);
  document.documentElement.lang = lang;
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (translations[lang][key]) {
      if (htmlI18nKeys.includes(key)) {
        el.innerHTML = translations[lang][key];
      } else {
        el.textContent = translations[lang][key];
      }
    }
  });
  document.querySelectorAll('[data-i18n-alt]').forEach(el => {
    const key = el.getAttribute('data-i18n-alt');
    if (translations[lang][key]) {
      el.setAttribute('alt', translations[lang][key]);
    }
  });
}

function initLanguage() {
  const saved = localStorage.getItem('lang') || 'en';
  const select = document.getElementById('language-select');
  const toggle = document.getElementById('language-toggle');
  if (select) {
    select.value = saved;
    select.addEventListener('change', e => {
      setLanguage(e.target.value);
      select.classList.add('hidden');
    });
  }
  if (toggle && select) {
    toggle.addEventListener('click', () => {
      select.classList.toggle('hidden');
    });
  }
  setLanguage(saved);
}

function initTheme() {
  let saved = localStorage.getItem('theme');
  if (!saved) {
    saved = 'dark';
    localStorage.setItem('theme', 'dark');
  }
  if (saved === 'dark') {
    document.body.classList.add('dark-theme');
  }
  const toggle = document.getElementById('theme-toggle');
  if (toggle) {
    const updateIcon = () => {
      toggle.textContent = document.body.classList.contains('dark-theme') ? '☀️' : '🌙';
    };
    updateIcon();
    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
      updateIcon();
    });
  }
}

function initAnimations() {
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('show');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.animate').forEach(el => observer.observe(el));
}

function initCarousel() {
  if (carouselInterval) {
    clearInterval(carouselInterval);
    carouselInterval = null;
  }
  const body = document.body;
  if (body.classList.contains('device-phone')) {
    const container = document.querySelector('.center-item');
    if (!container) return;
    container.querySelectorAll('img:not(:first-child)').forEach(img => img.remove());
    let currentImg = container.querySelector('img');
    if (!currentImg) return;
    const overlay = container.querySelector('.overlay');
    const mobileImages = [
      'images/carousel1.jpg',
      'images/carousel2.jpg',
      'images/carousel3.jpg',
      'images/carousel5.jpg'
    ];
    let index = 0;
    function showImage(i, instant = false) {
      if (instant) {
        currentImg.src = mobileImages[i];
        if (currentImg.complete) {
          updateOverlayColor();
        } else {
          currentImg.addEventListener('load', updateOverlayColor, { once: true });
        }
        return;
      }
      const prevImg = currentImg;
      const nextImg = document.createElement('img');
      nextImg.src = mobileImages[i];
      nextImg.classList.add('next');
      if (overlay) {
        container.insertBefore(nextImg, overlay);
      } else {
        container.appendChild(nextImg);
      }
      requestAnimationFrame(() => {
        prevImg.classList.add('slide-out-left');
        nextImg.classList.add('slide-in-right');
      });
      prevImg.addEventListener('transitionend', () => prevImg.remove(), { once: true });
      nextImg.addEventListener('transitionend', () => {
        nextImg.classList.remove('next', 'slide-in-right');
        currentImg = nextImg;
        updateOverlayColor();
      }, { once: true });
    }
    showImage(index, true);
    carouselInterval = setInterval(() => {
      index = (index + 1) % mobileImages.length;
      showImage(index);
    }, 5000);
    return;
  }
  const items = Array.from(document.querySelectorAll('.image-item'));
  if (!items.length) return;
  items.forEach(item => {
    const imgs = item.querySelectorAll('img');
    imgs.forEach((img, idx) => { if (idx > 0) img.remove(); });
  });
  const imageSets = [
    ['images/carousel1.jpg', 'images/carousel2.jpg', 'images/carousel3.jpg'],
    ['images/carousel4.jpg', 'images/carousel5.jpg', 'images/carousel1.jpg']
  ];
  let index = 0;
  function showSet(i, instant = false) {
    items.forEach((item, idx) => {
      const currentImg = item.querySelector('img');
      if (!currentImg) return;
      const overlay = item.querySelector('.overlay');
      if (instant) {
        currentImg.src = imageSets[i][idx];
        if (item === items[1]) {
          if (currentImg.complete) {
            updateOverlayColor();
          } else {
            currentImg.addEventListener('load', updateOverlayColor, { once: true });
          }
        }
        return;
      }
      const nextImg = document.createElement('img');
      nextImg.src = imageSets[i][idx];
      nextImg.classList.add('next');
      if (overlay) {
        item.insertBefore(nextImg, overlay);
      } else {
        item.appendChild(nextImg);
      }
      requestAnimationFrame(() => {
        currentImg.classList.add('slide-out-left');
        nextImg.classList.add('slide-in-right');
      });
      currentImg.addEventListener('transitionend', () => currentImg.remove(), { once: true });
      nextImg.addEventListener('transitionend', () => {
        nextImg.classList.remove('next', 'slide-in-right');
        if (item === items[1]) {
          updateOverlayColor();
        }
      }, { once: true });
    });
  }
  showSet(index, true);
  carouselInterval = setInterval(() => {
    index = (index + 1) % imageSets.length;
    showSet(index);
  }, 5000);
}

function updateOverlayColor() {
  const img = document.querySelector('.center-item img');
  if (!img) return;
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
  let r = 0, g = 0, b = 0, count = 0;
  for (let i = 0; i < data.length; i += 400) {
    r += data[i];
    g += data[i + 1];
    b += data[i + 2];
    count++;
  }
  const avgR = r / count;
  const avgG = g / count;
  const avgB = b / count;
  const brightness = 0.299 * avgR + 0.587 * avgG + 0.114 * avgB;
  const color = brightness > 128 ? '#000000' : '#ffffff';
  document.documentElement.style.setProperty('--overlay-color', color);
}

function initNavScroll() {
  const nav = document.querySelector('nav');
  if (!nav || document.body.classList.contains('device-phone')) return;
  let lastScroll = window.pageYOffset;
  window.addEventListener('scroll', () => {
    const current = window.pageYOffset;
    if (current > lastScroll) {
      nav.classList.add('nav-hidden');
    } else {
      nav.classList.remove('nav-hidden');
    }
    lastScroll = current;
  });
}

function initIntroScroll() {
  const intro = document.getElementById('putter-intro');
  if (!intro) return;
  const navHeight = document.querySelector('nav')?.offsetHeight || 0;
  window.scrollTo(0, 0);
  function prevent(e) { e.preventDefault(); }
  let blocker;
  function disableInput() {
    blocker = document.createElement('div');
    blocker.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;';
    document.body.appendChild(blocker);
    ['wheel', 'touchmove'].forEach(evt => window.addEventListener(evt, prevent, { passive: false }));
    window.addEventListener('keydown', prevent, { passive: false });
  }
  function enableInput() {
    blocker?.remove();
    ['wheel', 'touchmove'].forEach(evt => window.removeEventListener(evt, prevent, { passive: false }));
    window.removeEventListener('keydown', prevent, { passive: false });
  }
  function handleFirstScroll() {
    disableInput();
    const target = intro.getBoundingClientRect().top + window.pageYOffset - navHeight;
    window.scrollTo({ top: target, behavior: 'smooth' });
    function checkScroll() {
      if (window.pageYOffset >= target) {
        enableInput();
        window.removeEventListener('scroll', checkScroll);
      }
    }
    window.addEventListener('scroll', checkScroll);
  }
  window.addEventListener('scroll', handleFirstScroll, { once: true });
}

function initMobileMenu() {
  const menuToggle = document.getElementById('menu-toggle');
  const nav = document.querySelector('nav');
  if (!menuToggle || !nav) return;
  menuToggle.addEventListener('click', () => {
    nav.classList.toggle('open');
  });
  nav.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => nav.classList.remove('open'));
  });
}

function initDeviceDetection() {
  const body = document.body;
  function updateDevice() {
    const width = window.innerWidth;
    let newDevice;
    if (width <= 600) {
      newDevice = 'device-phone';
    } else if (width <= 992) {
      newDevice = 'device-tablet';
    } else {
      newDevice = 'device-desktop';
    }
    if (currentDevice !== newDevice) {
      body.classList.remove('device-phone', 'device-tablet', 'device-desktop');
      body.classList.add(newDevice);
      currentDevice = newDevice;
      initCarousel();
      const nav = document.querySelector('nav');
      if (nav) nav.classList.remove('open');
    }
  }
  updateDevice();
  window.addEventListener('resize', updateDevice);
}

const productData = [
  {
    id: 'kh888',
    nameKey: 'product_kh888_name',
      descKey: 'product_kh888_desc',
      priceKey: 'product_kh888_price',
      detailsKey: 'product_kh888_details',
      specsKey: 'product_kh888_specs',
      image: 'DRIVERS/KH888/KH888.jpg',
    images: [
      'DRIVERS/KH888/KH888.jpg',
      'DRIVERS/KH888/163040d2a71f650c8db20e82842ed001.jpg',
      'DRIVERS/KH888/1bd8db61bfe2d55cc16879b197540a17.jpg',
      'DRIVERS/KH888/79806404c304699e68660657e00aaa57.jpg'
    ],
    category: 'clubs',
    type: 'drivers'
  },
  {
    id: 'kh555',
    nameKey: 'product_kh555_name',
    descKey: 'product_kh555_desc',
    priceKey: 'product_kh555_price',
    detailsKey: 'product_kh555_details',
    image: 'KH555/9182c9a214b86d5914344b07696bfe3e.jpg',
    images: [
      'KH555/9182c9a214b86d5914344b07696bfe3e.jpg',
      'KH555/2781a0ba27f8d0c53a3f435136f0b1e1.jpg',
      'KH555/30f2ed2ad346e02591f747cee3e8a232.jpg',
      'KH555/7b7e2b56cc90f6bbbbb50675905656b5.jpg',
      'KH555/s.jpg'
    ],
    category: 'clubs',
    type: 'drivers'
  }
];

let modal, modalImg, modalPrev, modalNext, modalClose;
let modalTitle, modalDesc, modalPrice, modalDetails, modalSpecs;
let modalImages = [];
let modalIndex = 0;
let modalTimer;

function openProductModal(product) {
  modalImages = product.images;
  modalIndex = 0;
  const lang = document.documentElement.lang || 'en';
  updateModalImage();
  if (modalTitle) {
    modalTitle.textContent = translations[lang][product.nameKey];
    if (product.id === 'kh888') {
      modalTitle.classList.add('kh888-highlight');
    } else {
      modalTitle.classList.remove('kh888-highlight');
    }
  }
  if (modalDesc) modalDesc.textContent = translations[lang][product.descKey];
  if (modalPrice) {
    modalPrice.innerHTML = translations[lang][product.priceKey];
    modalPrice.setAttribute('data-i18n', product.priceKey);
  }
  if (modalDetails && product.detailsKey) {
    modalDetails.textContent = translations[lang][product.detailsKey];
  }
  if (modalSpecs) {
    if (product.specsKey) {
      modalSpecs.innerHTML = translations[lang][product.specsKey];
      modalSpecs.classList.remove('hidden');
      modalSpecs.setAttribute('data-i18n', product.specsKey);
    } else {
      modalSpecs.classList.add('hidden');
    }
  }
  modal.classList.remove('hidden', 'closing');
  const content = modal.querySelector('.modal-content');
  if (content) content.classList.remove('closing');
  document.body.classList.add('modal-open');
  modalTimer = setInterval(nextModalImage, 3000);
}

function closeProductModal() {
  if (!modal) return;
  clearInterval(modalTimer);
  const content = modal.querySelector('.modal-content');
  modal.classList.add('closing');
  if (content) content.classList.add('closing');
  const handleAnimationEnd = () => {
    modal.classList.add('hidden');
    modal.classList.remove('closing');
    if (content) content.classList.remove('closing');
  };
  if (content) {
    content.addEventListener('animationend', handleAnimationEnd, { once: true });
  } else {
    handleAnimationEnd();
  }
  document.body.classList.remove('modal-open');
}

function updateModalImage() {
  if (modalImg) {
    modalImg.classList.remove('fade');
    void modalImg.offsetWidth;
    modalImg.src = modalImages[modalIndex];
    modalImg.classList.add('fade');
  }
}

function nextModalImage() {
  modalIndex = (modalIndex + 1) % modalImages.length;
  updateModalImage();
}

function prevModalImage() {
  modalIndex = (modalIndex - 1 + modalImages.length) % modalImages.length;
  updateModalImage();
}

function initProductModal() {
  modal = document.getElementById('product-modal');
  if (!modal) return;
  modalImg = modal.querySelector('.modal-image');
  modalPrev = modal.querySelector('.prev');
  modalNext = modal.querySelector('.next');
  modalClose = modal.querySelector('.close');
  modalTitle = modal.querySelector('.modal-title');
  modalDesc = modal.querySelector('.modal-desc');
  modalPrice = modal.querySelector('.modal-price');
  modalDetails = modal.querySelector('.modal-details');
  modalSpecs = modal.querySelector('.modal-specs');
  if (modalImg) {
    modalImg.addEventListener('animationend', () => modalImg.classList.remove('fade'));
  }
  if (modalPrev) modalPrev.addEventListener('click', e => { e.stopPropagation(); prevModalImage(); });
  if (modalNext) modalNext.addEventListener('click', e => { e.stopPropagation(); nextModalImage(); });
  if (modalClose) modalClose.addEventListener('click', closeProductModal);
  modal.addEventListener('click', e => { if (e.target === modal) closeProductModal(); });
}

function renderProducts(filter = {}) {
  const grid = document.getElementById('product-grid');
  if (!grid) return;
  grid.innerHTML = '';
  const lang = document.documentElement.lang || 'en';
  const items = productData.filter(p => {
    if (filter.category && p.category !== filter.category) return false;
    if (filter.type && p.type !== filter.type) return false;
    return true;
  });
  if (!items.length) {
    const msg = document.createElement('p');
    msg.setAttribute('data-i18n', 'no_products');
    msg.textContent = translations[lang].no_products;
    grid.appendChild(msg);
    return;
  }
  items.forEach(p => {
    const div = document.createElement('div');
    div.className = 'product animate';
    const name = translations[lang][p.nameKey];
    div.innerHTML = `
      <img src="${p.image}" alt="${name}" data-i18n-alt="${p.nameKey}" class="product-image" loading="lazy">
      <h2 data-i18n="${p.nameKey}">${name}</h2>
      <p data-i18n="${p.descKey}">${translations[lang][p.descKey]}</p>
      <p class="price" data-i18n="${p.priceKey}">${translations[lang][p.priceKey]}</p>
    `;
    div.addEventListener('click', () => openProductModal(p));
    grid.appendChild(div);
  });
  initAnimations();
}

function initProducts() {
  const grid = document.getElementById('product-grid');
  if (!grid) return;

  const clubDropdown = document.getElementById('club-dropdown');
  const clubsBtn = document.querySelector('.category-btn[data-category="clubs"]');
  if (clubDropdown && clubsBtn) {
    clubsBtn.addEventListener('click', () => {
      clubDropdown.classList.toggle('hidden');
    });
  }

  document.querySelectorAll('.category-btn').forEach(btn => {
    const category = btn.dataset.category;
    if (category !== 'clubs') {
      btn.addEventListener('click', () => {
        renderProducts({ category });
        if (clubDropdown) {
          clubDropdown.classList.add('hidden');
        }
      });
    }
  });

  document.querySelectorAll('.club-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.dataset.type;
      renderProducts({ category: 'clubs', type });
      if (clubDropdown) {
        clubDropdown.classList.add('hidden');
      }
    });
  });

  const viewSelect = document.getElementById('view-select');
  if (viewSelect) {
    viewSelect.addEventListener('change', e => {
      grid.classList.remove('grid-4', 'grid-5');
      grid.classList.add(`grid-${e.target.value}`);
    });
  }
  // Show all products by default
  renderProducts();
}

document.addEventListener('DOMContentLoaded', () => {
  initLanguage();
  initTheme();
  initAnimations();
  initDeviceDetection();
  initMobileMenu();
  initNavScroll();
  initProducts();
  initIntroScroll();
  initProductModal();
});
