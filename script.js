const translations = {
  en: {
    nav_home: 'Home',
    nav_products: 'Products',
    nav_contact: 'Contact',
    theme_toggle: 'Toggle Theme',
    language_label: 'Language',
    home_title: 'KENTACK Luxury Golf Experience',
    home_desc: 'Discover high-end golf gear for champions.',
      hero_cta: 'Shop Now',
      explore_collection: 'Explore the Collection',
      crafted_limited_timeless: 'Crafted. Limited. Timeless.',
      find_out_more: 'Find out more',
      story_title: 'Message from Ken Karahawa',
    story_message: `The name Golf Honma has long symbolized top-class Japanese craftsmanship, admired by golfers worldwide. Our KENTACK brand carries forward this proud tradition and superior techniques. Founded in 2007 by Yukihiro Honma, co-founder of Honma Golf, KENTACK was created to preserve the spirit and identity of the original Honma legacy after the brand became foreign-owned.\n\nYukihiro Honma, a master craftsman, once produced the finest clubs under the name HIRO HONMA, blending performance and beauty with over 50 years of expertise. With KENTACK, he revived that genuine tradition. Though he has since stepped back, his techniques and philosophy remain at the heart of our work.\n\nToday, KENTACK continues to craft elegant, precise, and high-performing clubs through meticulous Japanese artistry. We are committed to honoring our heritage while advancing technology, delivering top-quality clubs that add value for discerning golfers worldwide.`,
    products_title: 'Our Products',
    category_clubs: 'Clubs',
    category_bags: 'Bags',
    category_balls: 'Balls',
    category_tees: 'Tees',
    category_accessories: 'Accessories',
      club_drivers: 'Drivers',
      club_woods: 'Woods',
    club_irons: 'Irons',
    club_hybrids: 'Hybrids',
    club_wedges: 'Wedges',
    club_putters: 'Putters',
    view_4x4: '4 x 4',
    view_5x5: '5 x 5',
    no_products: 'No products available.',
    contact_title: 'Contact Us',
    contact_phone: 'Phone: 0899033692',
    contact_location_title: 'Location',
    contact_location: 'Phá»‘ TÃ¢n Má»¹, PhÆ°Æ¡ng Quan, Nam Tá»« LiÃªm, HÃ  Ná»™i, Vietnam',
    product_kh888_name: 'KH888 Driver',
    product_kh888_desc: 'High-performance driver.',
    product_kh888_price: 'Starting from $1,110',
    product_kh888_details: 'Engineered with a lightweight carbon crown and precision milled face, the KH888 delivers explosive distance and unmatched forgiveness. Its adjustable hosel lets you fine tune loft and lie for your swing, while premium shafts provide exceptional feel and control. Ideal for players seeking tour-level performance in a handcrafted package.'
  },
  vi: {
    nav_home: 'Trang chá»§',
    nav_products: 'Sáº£n pháº©m',
    nav_contact: 'LiÃªn há»‡',
    theme_toggle: 'Äá»•i chá»§ Ä‘á»',
    language_label: 'NgÃ´n ngá»¯',
    home_title: 'KENTACK - Tráº£i nghiá»‡m Golf Sang Trá»ng',
    home_desc: 'KhÃ¡m phÃ¡ thiáº¿t bá»‹ golf cao cáº¥p dÃ nh cho nhÃ  vÃ´ Ä‘á»‹ch.',
      hero_cta: 'Mua Ngay',
      explore_collection: 'KhÃ¡m phÃ¡ Bá»™ SÆ°u Táº­p',
      crafted_limited_timeless: 'Tinh xáº£o. Giá»›i háº¡n. VÆ°á»£t thá»i gian.',
      find_out_more: 'TÃ¬m hiá»ƒu thÃªm',
      story_title: 'ThÃ´ng Ä‘iá»‡p tá»« Ken Karahawa',
    story_message: `TÃªn Golf Honma tá»« lÃ¢u Ä‘Ã£ tÆ°á»£ng trÆ°ng cho tay nghá» Nháº­t Báº£n Ä‘áº³ng cáº¥p, Ä‘Æ°á»£c cÃ¡c golfer trÃªn toÃ n tháº¿ giá»›i ngÆ°á»¡ng má»™. ThÆ°Æ¡ng hiá»‡u KENTACK cá»§a chÃºng tÃ´i tiáº¿p ná»‘i truyá»n thá»‘ng Ä‘Ã¡ng tá»± hÃ o vÃ  ká»¹ thuáº­t Æ°u viá»‡t Ä‘Ã³. ÄÆ°á»£c thÃ nh láº­p nÄƒm 2007 bá»Ÿi Ã´ng Yukihiro Honma, Ä‘á»“ng sÃ¡ng láº­p Honma Golf, KENTACK ra Ä‘á»i Ä‘á»ƒ gÃ¬n giá»¯ tinh tháº§n vÃ  báº£n sáº¯c di sáº£n Honma nguyÃªn báº£n sau khi thÆ°Æ¡ng hiá»‡u trá»Ÿ thÃ nh sá»Ÿ há»¯u nÆ°á»›c ngoÃ i.\n\nYukihiro Honma, má»™t báº­c tháº§y cháº¿ tÃ¡c, tá»«ng táº¡o ra nhá»¯ng cÃ¢y gáº­y hoÃ n háº£o nháº¥t dÆ°á»›i tÃªn HIRO HONMA, káº¿t há»£p hiá»‡u suáº¥t vÃ  váº» Ä‘áº¹p vá»›i hÆ¡n 50 nÄƒm kinh nghiá»‡m. Vá»›i KENTACK, Ã´ng Ä‘Ã£ há»“i sinh truyá»n thá»‘ng chÃ¢n chÃ­nh Ä‘Ã³. DÃ¹ nay Ã´ng Ä‘Ã£ lui vá», ká»¹ thuáº­t vÃ  triáº¿t lÃ½ cá»§a Ã´ng váº«n lÃ  cá»‘t lÃµi trong cÃ´ng viá»‡c cá»§a chÃºng tÃ´i.\n\nNgÃ y nay, KENTACK tiáº¿p tá»¥c cháº¿ tÃ¡c nhá»¯ng cÃ¢y gáº­y thanh lá»‹ch, chÃ­nh xÃ¡c vÃ  hiá»‡u suáº¥t cao báº±ng nghá»‡ thuáº­t Nháº­t Báº£n tá»‰ má»‰. ChÃºng tÃ´i cam káº¿t tÃ´n vinh di sáº£n Ä‘á»“ng thá»i phÃ¡t triá»ƒn cÃ´ng nghá»‡, mang Ä‘áº¿n nhá»¯ng cÃ¢y gáº­y cháº¥t lÆ°á»£ng hÃ ng Ä‘áº§u táº¡o giÃ¡ trá»‹ cho cÃ¡c golfer sÃ nh Ä‘iá»‡u trÃªn toÃ n tháº¿ giá»›i.`,
    products_title: 'Sáº£n pháº©m cá»§a chÃºng tÃ´i',
    category_clubs: 'Gáº­y',
    category_bags: 'TÃºi',
    category_balls: 'BÃ³ng',
    category_tees: 'Tee',
    category_accessories: 'Phá»¥ kiá»‡n',
    club_drivers: 'Gáº­y driver',
    club_woods: 'Gáº­y gá»—',
    club_irons: 'Gáº­y sáº¯t',
    club_hybrids: 'Gáº­y hybrid',
    club_wedges: 'Gáº­y kÄ© thuáº­t',
    club_putters: 'Gáº­y putter',
    view_4x4: '4 x 4',
    view_5x5: '5 x 5',
    no_products: 'KhÃ´ng cÃ³ sáº£n pháº©m.',
    contact_title: 'LiÃªn há»‡ vá»›i chÃºng tÃ´i',
    contact_phone: 'Äiá»‡n thoáº¡i: 0899033692',
    contact_location_title: 'Äá»‹a chá»‰',
    contact_location: 'Phá»‘ TÃ¢n Má»¹, PhÆ°Æ¡ng Quan, Nam Tá»« LiÃªm, HÃ  Ná»™i, Vietnam',
    product_kh888_name: 'KH888',
    product_kh888_desc: 'Gáº­y driver hiá»‡u suáº¥t cao.',
    product_kh888_price: 'GiÃ¡ tá»« 1.110$',
    product_kh888_details: 'ÄÆ°á»£c cháº¿ táº¡o vá»›i crown carbon siÃªu nháº¹ vÃ  máº·t gáº­y phay chÃ­nh xÃ¡c, KH888 mang láº¡i khoáº£ng cÃ¡ch vÆ°á»£t trá»™i vÃ  Ä‘á»™ khoan dung áº¥n tÆ°á»£ng. Hosel cÃ³ thá»ƒ Ä‘iá»u chá»‰nh cho phÃ©p báº¡n tinh chá»‰nh loft vÃ  lie phÃ¹ há»£p vá»›i cÃº swing, trong khi shaft cao cáº¥p mang láº¡i cáº£m giÃ¡c vÃ  kháº£ nÄƒng kiá»ƒm soÃ¡t tuyá»‡t vá»i.'
  },
  ja: {
    nav_home: 'ãƒ›ãƒ¼ãƒ ',
    nav_products: 'è£½å“',
    nav_contact: 'ãŠå•ã„åˆã‚ã›',
    theme_toggle: 'ãƒ†ãƒ¼ãƒžåˆ‡æ›¿',
    language_label: 'è¨€èªž',
    home_title: 'KENTACK ãƒ©ã‚°ã‚¸ãƒ¥ã‚¢ãƒªãƒ¼ãªã‚´ãƒ«ãƒ•ä½“é¨“',
    home_desc: 'ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã®ãŸã‚ã®é«˜ç´šã‚´ãƒ«ãƒ•ç”¨å“ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ã€‚',
      hero_cta: 'ä»Šã™ãè³¼å…¥',
      explore_collection: 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŽ¢ã‚‹',
      crafted_limited_timeless: 'åŒ ã®æŠ€ã€‚é™å®šã€‚æ™‚ã‚’è¶…ãˆã¦ã€‚',
      find_out_more: 'è©³ã—ãè¦‹ã‚‹',
      story_title: 'å”å·ã‚±ãƒ³ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
    story_message: `ã€Œã‚´ãƒ«ãƒ•æœ¬é–“ã€ã¨ã„ã†åå‰ã¯ã€é•·å¹´ã«ã‚ãŸã‚Šæ—¥æœ¬æœ€é«˜å³°ã®è·äººæŠ€ã®è±¡å¾´ã¨ã—ã¦ã€ä¸–ç•Œä¸­ã®ã‚´ãƒ«ãƒ•ã‚¡ãƒ¼ã«æ„›ã•ã‚Œã¦ãã¾ã—ãŸã€‚ç§ãŸã¡ã®KENTACKãƒ–ãƒ©ãƒ³ãƒ‰ã¯ã€ã“ã®èª‡ã‚Šé«˜ã„ä¼çµ±ã¨å„ªã‚ŒãŸæŠ€è¡“ã‚’å—ã‘ç¶™ã„ã§ã„ã¾ã™ã€‚KENTACKã¯æœ¬é–“ã‚´ãƒ«ãƒ•ã®å…±åŒå‰µæ¥­è€…ã€æœ¬é–“å¹¸å®ã«ã‚ˆã£ã¦2007å¹´ã«è¨­ç«‹ã•ã‚Œã€ãƒ–ãƒ©ãƒ³ãƒ‰ãŒå¤–å›½è³‡æœ¬ã¨ãªã£ãŸå¾Œã‚‚æœ¬æ¥ã®æœ¬é–“ã®ç²¾ç¥žã¨ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å®ˆã‚‹ãŸã‚ã«ç”Ÿã¾ã‚Œã¾ã—ãŸã€‚\n\nååŒ ã§ã‚ã‚‹æœ¬é–“å¹¸å®ã¯ã€ã‹ã¤ã¦HIRO HONMAã®åã§æœ€é«˜ç´šã®ã‚¯ãƒ©ãƒ–ã‚’ä½œã‚Šä¸Šã’ã€50å¹´ä»¥ä¸Šã®çµŒé¨“ã§æ€§èƒ½ã¨ç¾Žã‚’èžåˆã•ã›ã¾ã—ãŸã€‚KENTACKã«ã‚ˆã£ã¦å½¼ã¯ãã®çœŸã®ä¼çµ±ã‚’å¾©æ´»ã•ã›ã¾ã—ãŸã€‚ç¾åœ¨ã¯ç¬¬ä¸€ç·šã‚’é€€ã„ã¦ã„ã¾ã™ãŒã€å½¼ã®æŠ€è¡“ã¨ç†å¿µã¯ä»Šã‚‚ç§ãŸã¡ã®ä¸­å¿ƒã«ã‚ã‚Šã¾ã™ã€‚\n\nä»Šæ—¥ã®KENTACKã¯ã€ç·»å¯†ãªæ—¥æœ¬ã®è·äººæŠ€ã§ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã§ç²¾å¯†ã€ãã—ã¦é«˜æ€§èƒ½ãªã‚¯ãƒ©ãƒ–ã‚’ä½œã‚Šç¶šã‘ã¦ã„ã¾ã™ã€‚ç§ãŸã¡ã¯éºç”£ã‚’å°Šé‡ã—ã¤ã¤æŠ€è¡“ã‚’é€²åŒ–ã•ã›ã€ä¸–ç•Œä¸­ã®ç›®ã®è‚¥ãˆãŸã‚´ãƒ«ãƒ•ã‚¡ãƒ¼ã«ä¾¡å€¤ã‚ã‚‹æœ€é«˜å“è³ªã®ã‚¯ãƒ©ãƒ–ã‚’æä¾›ã—ç¶šã‘ã¾ã™ã€‚`,
    products_title: 'è£½å“ä¸€è¦§',
    category_clubs: 'ã‚¯ãƒ©ãƒ–',
    category_bags: 'ãƒãƒƒã‚°',
    category_balls: 'ãƒœãƒ¼ãƒ«',
    category_tees: 'ãƒ†ã‚£ãƒ¼',
    category_accessories: 'ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼',
    club_drivers: 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
    club_woods: 'ã‚¦ãƒƒãƒ‰',
    club_irons: 'ã‚¢ã‚¤ã‚¢ãƒ³',
    club_hybrids: 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰',
    club_wedges: 'ã‚¦ã‚§ãƒƒã‚¸',
    club_putters: 'ãƒ‘ã‚¿ãƒ¼',
    view_4x4: '4 x 4',
    view_5x5: '5 x 5',
    no_products: 'å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚',
    contact_title: 'ãŠå•ã„åˆã‚ã›',
    contact_phone: 'é›»è©±: 0899033692',
    contact_location_title: 'ä½æ‰€',
    contact_location: 'Phá»‘ TÃ¢n Má»¹, PhÆ°Æ¡ng Quan, Nam Tá»« LiÃªm, HÃ  Ná»™i, Vietnam',
    product_kh888_name: 'KH888ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
    product_kh888_desc: 'é«˜æ€§èƒ½ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã€‚',
    product_kh888_price: '1,110ãƒ‰ãƒ«ã‹ã‚‰',
    product_kh888_details: 'è»½é‡ã‚«ãƒ¼ãƒœãƒ³ã‚¯ãƒ©ã‚¦ãƒ³ã¨ç²¾å¯†ã«å‰Šã‚Šå‡ºã•ã‚ŒãŸãƒ•ã‚§ãƒ¼ã‚¹ã‚’å‚™ãˆãŸKH888ã¯ã€é©šç•°çš„ãªé£›è·é›¢ã¨å¯›å®¹æ€§ã‚’ç™ºæ®ã—ã¾ã™ã€‚èª¿æ•´å¯èƒ½ãªãƒ›ãƒ¼ã‚¼ãƒ«ã«ã‚ˆã‚Šãƒ­ãƒ•ãƒˆã¨ãƒ©ã‚¤ã‚’å¾®èª¿æ•´ã§ãã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚·ãƒ£ãƒ•ãƒˆãŒå“è¶Šã—ãŸãƒ•ã‚£ãƒ¼ãƒªãƒ³ã‚°ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚'
  }
};

let carouselInterval;
let currentDevice;

function setLanguage(lang) {
  localStorage.setItem('lang', lang);
  document.documentElement.lang = lang;
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (translations[lang][key]) {
      el.textContent = translations[lang][key];
    }
  });
  document.querySelectorAll('[data-i18n-alt]').forEach(el => {
    const key = el.getAttribute('data-i18n-alt');
    if (translations[lang][key]) {
      el.setAttribute('alt', translations[lang][key]);
    }
  });
}

function initLanguage() {
  const saved = localStorage.getItem('lang') || 'en';
  const select = document.getElementById('language-select');
  const toggle = document.getElementById('language-toggle');
  if (select) {
    select.value = saved;
    select.addEventListener('change', e => {
      setLanguage(e.target.value);
      select.classList.add('hidden');
    });
  }
  if (toggle && select) {
    toggle.addEventListener('click', () => {
      select.classList.toggle('hidden');
    });
  }
  setLanguage(saved);
}

function initTheme() {
  let saved = localStorage.getItem('theme');
  if (!saved) {
    saved = 'dark';
    localStorage.setItem('theme', 'dark');
  }
  if (saved === 'dark') {
    document.body.classList.add('dark-theme');
  }
  const toggle = document.getElementById('theme-toggle');
  if (toggle) {
    const updateIcon = () => {
      toggle.textContent = document.body.classList.contains('dark-theme') ? 'â˜€ï¸' : 'ðŸŒ™';
    };
    updateIcon();
    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
      updateIcon();
    });
  }
}

function initAnimations() {
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('show');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.animate').forEach(el => observer.observe(el));
}

function initCarousel() {
  if (carouselInterval) {
    clearInterval(carouselInterval);
    carouselInterval = null;
  }
  const body = document.body;
  if (body.classList.contains('device-phone')) {
    const container = document.querySelector('.center-item');
    if (!container) return;
    container.querySelectorAll('img:not(:first-child)').forEach(img => img.remove());
    let currentImg = container.querySelector('img');
    if (!currentImg) return;
    const overlay = container.querySelector('.overlay');
    const mobileImages = [
      'images/carousel1.jpg',
      'images/carousel2.jpg',
      'images/carousel3.jpg',
      'images/carousel5.jpg'
    ];
    let index = 0;
    function showImage(i, instant = false) {
      if (instant) {
        currentImg.src = mobileImages[i];
        if (currentImg.complete) {
          updateOverlayColor();
        } else {
          currentImg.addEventListener('load', updateOverlayColor, { once: true });
        }
        return;
      }
      const prevImg = currentImg;
      const nextImg = document.createElement('img');
      nextImg.src = mobileImages[i];
      nextImg.classList.add('next');
      if (overlay) {
        container.insertBefore(nextImg, overlay);
      } else {
        container.appendChild(nextImg);
      }
      requestAnimationFrame(() => {
        prevImg.classList.add('slide-out-left');
        nextImg.classList.add('slide-in-right');
      });
      prevImg.addEventListener('transitionend', () => prevImg.remove(), { once: true });
      nextImg.addEventListener('transitionend', () => {
        nextImg.classList.remove('next', 'slide-in-right');
        currentImg = nextImg;
        updateOverlayColor();
      }, { once: true });
    }
    showImage(index, true);
    carouselInterval = setInterval(() => {
      index = (index + 1) % mobileImages.length;
      showImage(index);
    }, 5000);
    return;
  }
  const items = Array.from(document.querySelectorAll('.image-item'));
  if (!items.length) return;
  items.forEach(item => {
    const imgs = item.querySelectorAll('img');
    imgs.forEach((img, idx) => { if (idx > 0) img.remove(); });
  });
  const imageSets = [
    ['images/carousel1.jpg', 'images/carousel2.jpg', 'images/carousel3.jpg'],
    ['images/carousel4.jpg', 'images/carousel5.jpg', 'images/carousel1.jpg']
  ];
  let index = 0;
  function showSet(i, instant = false) {
    items.forEach((item, idx) => {
      const currentImg = item.querySelector('img');
      if (!currentImg) return;
      const overlay = item.querySelector('.overlay');
      if (instant) {
        currentImg.src = imageSets[i][idx];
        if (item === items[1]) {
          if (currentImg.complete) {
            updateOverlayColor();
          } else {
            currentImg.addEventListener('load', updateOverlayColor, { once: true });
          }
        }
        return;
      }
      const nextImg = document.createElement('img');
      nextImg.src = imageSets[i][idx];
      nextImg.classList.add('next');
      if (overlay) {
        item.insertBefore(nextImg, overlay);
      } else {
        item.appendChild(nextImg);
      }
      requestAnimationFrame(() => {
        currentImg.classList.add('slide-out-left');
        nextImg.classList.add('slide-in-right');
      });
      currentImg.addEventListener('transitionend', () => currentImg.remove(), { once: true });
      nextImg.addEventListener('transitionend', () => {
        nextImg.classList.remove('next', 'slide-in-right');
        if (item === items[1]) {
          updateOverlayColor();
        }
      }, { once: true });
    });
  }
  showSet(index, true);
  carouselInterval = setInterval(() => {
    index = (index + 1) % imageSets.length;
    showSet(index);
  }, 5000);
}

function updateOverlayColor() {
  const img = document.querySelector('.center-item img');
  if (!img) return;
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
  let r = 0, g = 0, b = 0, count = 0;
  for (let i = 0; i < data.length; i += 400) {
    r += data[i];
    g += data[i + 1];
    b += data[i + 2];
    count++;
  }
  const avgR = r / count;
  const avgG = g / count;
  const avgB = b / count;
  const brightness = 0.299 * avgR + 0.587 * avgG + 0.114 * avgB;
  const color = brightness > 128 ? '#000000' : '#ffffff';
  document.documentElement.style.setProperty('--overlay-color', color);
}

function initNavScroll() {
  const nav = document.querySelector('nav');
  if (!nav || document.body.classList.contains('device-phone')) return;
  let lastScroll = window.pageYOffset;
  window.addEventListener('scroll', () => {
    const current = window.pageYOffset;
    if (current > lastScroll) {
      nav.classList.add('nav-hidden');
    } else {
      nav.classList.remove('nav-hidden');
    }
    lastScroll = current;
  });
}

function initIntroScroll() {
  const intro = document.getElementById('putter-intro');
  if (!intro) return;
  const navHeight = document.querySelector('nav')?.offsetHeight || 0;
  window.scrollTo(0, 0);
  function prevent(e) { e.preventDefault(); }
  let blocker;
  function disableInput() {
    blocker = document.createElement('div');
    blocker.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;';
    document.body.appendChild(blocker);
    ['wheel', 'touchmove'].forEach(evt => window.addEventListener(evt, prevent, { passive: false }));
    window.addEventListener('keydown', prevent, { passive: false });
  }
  function enableInput() {
    blocker?.remove();
    ['wheel', 'touchmove'].forEach(evt => window.removeEventListener(evt, prevent, { passive: false }));
    window.removeEventListener('keydown', prevent, { passive: false });
  }
  function handleFirstScroll() {
    disableInput();
    const target = intro.getBoundingClientRect().top + window.pageYOffset - navHeight;
    window.scrollTo({ top: target, behavior: 'smooth' });
    function checkScroll() {
      if (window.pageYOffset >= target) {
        enableInput();
        window.removeEventListener('scroll', checkScroll);
      }
    }
    window.addEventListener('scroll', checkScroll);
  }
  window.addEventListener('scroll', handleFirstScroll, { once: true });
}

function initMobileMenu() {
  const menuToggle = document.getElementById('menu-toggle');
  const nav = document.querySelector('nav');
  if (!menuToggle || !nav) return;
  menuToggle.addEventListener('click', () => {
    nav.classList.toggle('open');
  });
  nav.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => nav.classList.remove('open'));
  });
}

function initDeviceDetection() {
  const body = document.body;
  function updateDevice() {
    const width = window.innerWidth;
    let newDevice;
    if (width <= 600) {
      newDevice = 'device-phone';
    } else if (width <= 992) {
      newDevice = 'device-tablet';
    } else {
      newDevice = 'device-desktop';
    }
    if (currentDevice !== newDevice) {
      body.classList.remove('device-phone', 'device-tablet', 'device-desktop');
      body.classList.add(newDevice);
      currentDevice = newDevice;
      initCarousel();
      const nav = document.querySelector('nav');
      if (nav) nav.classList.remove('open');
    }
  }
  updateDevice();
  window.addEventListener('resize', updateDevice);
}

const productData = [
  {
    id: 'kh888',
    nameKey: 'product_kh888_name',
    descKey: 'product_kh888_desc',
    priceKey: 'product_kh888_price',
    detailsKey: 'product_kh888_details',
    image: 'DRIVERS/KH888/KH888.jpg',
    images: [
      'DRIVERS/KH888/KH888.jpg',
      'DRIVERS/KH888/163040d2a71f650c8db20e82842ed001.jpg',
      'DRIVERS/KH888/1bd8db61bfe2d55cc16879b197540a17.jpg',
      'DRIVERS/KH888/79806404c304699e68660657e00aaa57.jpg'
    ],
    category: 'clubs',
    type: 'drivers'
  }
];

let modal, modalImg, modalPrev, modalNext, modalClose;
let modalTitle, modalDesc, modalPrice, modalDetails;
let modalImages = [];
let modalIndex = 0;
let modalTimer;

function openProductModal(product) {
  modalImages = product.images;
  modalIndex = 0;
  const lang = document.documentElement.lang || 'en';
  updateModalImage();
  if (modalTitle) modalTitle.textContent = translations[lang][product.nameKey];
  if (modalDesc) modalDesc.textContent = translations[lang][product.descKey];
  if (modalPrice) modalPrice.textContent = translations[lang][product.priceKey];
  if (modalDetails && product.detailsKey) {
    modalDetails.textContent = translations[lang][product.detailsKey];
  }
  modal.classList.remove('hidden');
  document.body.classList.add('modal-open');
  modalTimer = setInterval(nextModalImage, 3000);
}

function closeProductModal() {
  modal.classList.add('hidden');
  document.body.classList.remove('modal-open');
  clearInterval(modalTimer);
}

function updateModalImage() {
  if (modalImg) {
    modalImg.classList.remove('fade');
    void modalImg.offsetWidth;
    modalImg.src = modalImages[modalIndex];
    modalImg.classList.add('fade');
  }
}

function nextModalImage() {
  modalIndex = (modalIndex + 1) % modalImages.length;
  updateModalImage();
}

function prevModalImage() {
  modalIndex = (modalIndex - 1 + modalImages.length) % modalImages.length;
  updateModalImage();
}

function initProductModal() {
  modal = document.getElementById('product-modal');
  if (!modal) return;
  modalImg = modal.querySelector('.modal-image');
  modalPrev = modal.querySelector('.prev');
  modalNext = modal.querySelector('.next');
  modalClose = modal.querySelector('.close');
  modalTitle = modal.querySelector('.modal-title');
  modalDesc = modal.querySelector('.modal-desc');
  modalPrice = modal.querySelector('.modal-price');
  modalDetails = modal.querySelector('.modal-details');
  if (modalImg) {
    modalImg.addEventListener('animationend', () => modalImg.classList.remove('fade'));
  }
  if (modalPrev) modalPrev.addEventListener('click', e => { e.stopPropagation(); prevModalImage(); });
  if (modalNext) modalNext.addEventListener('click', e => { e.stopPropagation(); nextModalImage(); });
  if (modalClose) modalClose.addEventListener('click', closeProductModal);
  modal.addEventListener('click', e => { if (e.target === modal) closeProductModal(); });
}

function renderProducts(filter = {}) {
  const grid = document.getElementById('product-grid');
  if (!grid) return;
  grid.innerHTML = '';
  const lang = document.documentElement.lang || 'en';
  const items = productData.filter(p => {
    if (filter.category && p.category !== filter.category) return false;
    if (filter.type && p.type !== filter.type) return false;
    return true;
  });
  if (!items.length) {
    const msg = document.createElement('p');
    msg.setAttribute('data-i18n', 'no_products');
    msg.textContent = translations[lang].no_products;
    grid.appendChild(msg);
    return;
  }
  items.forEach(p => {
    const div = document.createElement('div');
    div.className = 'product animate';
    const name = translations[lang][p.nameKey];
    div.innerHTML = `
      <img src="${p.image}" alt="${name}" data-i18n-alt="${p.nameKey}" class="product-image" loading="lazy">
      <h2 data-i18n="${p.nameKey}">${name}</h2>
      <p data-i18n="${p.descKey}">${translations[lang][p.descKey]}</p>
      <p class="price" data-i18n="${p.priceKey}">${translations[lang][p.priceKey]}</p>
    `;
    div.addEventListener('click', () => openProductModal(p));
    grid.appendChild(div);
  });
  initAnimations();
}

function initProducts() {
  const grid = document.getElementById('product-grid');
  if (!grid) return;

  const clubDropdown = document.getElementById('club-dropdown');
  const clubsBtn = document.querySelector('.category-btn[data-category="clubs"]');
  if (clubDropdown && clubsBtn) {
    clubsBtn.addEventListener('click', () => {
      clubDropdown.classList.toggle('hidden');
    });
  }

  document.querySelectorAll('.category-btn').forEach(btn => {
    const category = btn.dataset.category;
    if (category !== 'clubs') {
      btn.addEventListener('click', () => {
        renderProducts({ category });
        if (clubDropdown) {
          clubDropdown.classList.add('hidden');
        }
      });
    }
  });

  document.querySelectorAll('.club-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.dataset.type;
      renderProducts({ category: 'clubs', type });
      if (clubDropdown) {
        clubDropdown.classList.add('hidden');
      }
    });
  });

  const viewSelect = document.getElementById('view-select');
  if (viewSelect) {
    viewSelect.addEventListener('change', e => {
      grid.classList.remove('grid-4', 'grid-5');
      grid.classList.add(`grid-${e.target.value}`);
    });
  }
  // Show all products by default
  renderProducts();
}

document.addEventListener('DOMContentLoaded', () => {
  initLanguage();
  initTheme();
  initAnimations();
  initDeviceDetection();
  initMobileMenu();
  initNavScroll();
  initProducts();
  initIntroScroll();
  initProductModal();
});
